ARM GAS  /tmp/ccl27WjO.s 			page 1


   1              		.syntax unified
   2              		.cpu cortex-m3
   3              		.fpu softvfp
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.thumb
  14              		.syntax unified
  15              		.file	"contactor_hv.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.section	.text.contactor_hv_uartline,"ax",%progbits
  20              		.align	2
  21              		.global	contactor_hv_uartline
  22              		.thumb
  23              		.thumb_func
  25              	contactor_hv_uartline:
  26              	.LFB69:
  27              		.file 1 "Ourtasks/contactor_hv.c"
   1:Ourtasks/contactor_hv.c **** /******************************************************************************
   2:Ourtasks/contactor_hv.c **** * File Name          : contactor_hv.c
   3:Ourtasks/contactor_hv.c **** * Date First Issued  : 07/04/2019
   4:Ourtasks/contactor_hv.c **** * Description        : hv uart conversion and recalibration
   5:Ourtasks/contactor_hv.c **** *******************************************************************************/
   6:Ourtasks/contactor_hv.c **** 
   7:Ourtasks/contactor_hv.c **** #include "contactor_hv.h"
   8:Ourtasks/contactor_hv.c **** #include "SerialTaskReceive.h"
   9:Ourtasks/contactor_hv.c **** #include "hexbin.h"
  10:Ourtasks/contactor_hv.c **** 
  11:Ourtasks/contactor_hv.c **** #include <string.h>
  12:Ourtasks/contactor_hv.c **** #include "morse.h"
  13:Ourtasks/contactor_hv.c **** 
  14:Ourtasks/contactor_hv.c **** 
  15:Ourtasks/contactor_hv.c **** /* *************************************************************************
  16:Ourtasks/contactor_hv.c ****  * void contactor_hv_uartline(struct CONTACTORFUNCTION* pcf);
  17:Ourtasks/contactor_hv.c ****  * @brief	: Get & convert ascii line to binary readings
  18:Ourtasks/contactor_hv.c ****  * @return	: readings stored in contactor function struct
  19:Ourtasks/contactor_hv.c ****  * *************************************************************************/
  20:Ourtasks/contactor_hv.c **** /*
  21:Ourtasks/contactor_hv.c **** Expect 13 hex chars: AAaaBBbbCCcc<CR> and,
  22:Ourtasks/contactor_hv.c **** place binary values in uint16_t array.
  23:Ourtasks/contactor_hv.c **** */
  24:Ourtasks/contactor_hv.c **** /* From ContactorTask.h for convenience 
  25:Ourtasks/contactor_hv.c **** struct CNCNTHV
  26:Ourtasks/contactor_hv.c **** {
  27:Ourtasks/contactor_hv.c **** 	struct CNTCTCALSI ical; // Scale integer calibration values
  28:Ourtasks/contactor_hv.c ****    float fhv;     // Calibrated: Float
  29:Ourtasks/contactor_hv.c **** 	uint32_t ihv;  // Calibrated: Scaled
  30:Ourtasks/contactor_hv.c **** 	uint16_t hv;   // Raw reading as received from uart
  31:Ourtasks/contactor_hv.c **** };
ARM GAS  /tmp/ccl27WjO.s 			page 2


  32:Ourtasks/contactor_hv.c **** */
  33:Ourtasks/contactor_hv.c **** void contactor_hv_uartline(struct CONTACTORFUNCTION* pcf)
  34:Ourtasks/contactor_hv.c **** {
  28              		.loc 1 34 0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              	.LVL0:
  33 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
  34              	.LCFI0:
  35              		.cfi_def_cfa_offset 24
  36              		.cfi_offset 3, -24
  37              		.cfi_offset 4, -20
  38              		.cfi_offset 5, -16
  39              		.cfi_offset 6, -12
  40              		.cfi_offset 7, -8
  41              		.cfi_offset 14, -4
  42 0002 0546     		mov	r5, r0
  43              	.LVL1:
  44              	.L6:
  35:Ourtasks/contactor_hv.c **** 	int i;
  36:Ourtasks/contactor_hv.c **** 	uint8_t* pline;	// Pointer to line buffer
  37:Ourtasks/contactor_hv.c **** 	do
  38:Ourtasks/contactor_hv.c **** 	{
  39:Ourtasks/contactor_hv.c **** 		/* Get pointer of next completed line. */
  40:Ourtasks/contactor_hv.c **** 		pline = (uint8_t*)xSerialTaskReceiveGetline(pcf->prbcb3);
  45              		.loc 1 40 0
  46 0004 D5F85801 		ldr	r0, [r5, #344]
  47 0008 FFF7FEFF 		bl	xSerialTaskReceiveGetline
  48              	.LVL2:
  41:Ourtasks/contactor_hv.c **** 		if (pline != NULL)
  49              		.loc 1 41 0
  50 000c 0146     		mov	r1, r0
  51 000e F0B1     		cbz	r0, .L2
  42:Ourtasks/contactor_hv.c **** 		{ // Here, a line is ready.
  43:Ourtasks/contactor_hv.c **** 			if (*(pline+12) != '\n') return; // Not correct line
  52              		.loc 1 43 0
  53 0010 037B     		ldrb	r3, [r0, #12]	@ zero_extendqisi2
  54 0012 0A2B     		cmp	r3, #10
  55 0014 1DD1     		bne	.L1
  56 0016 0020     		movs	r0, #0
  57              	.LVL3:
  58 0018 17E0     		b	.L4
  59              	.LVL4:
  60              	.L5:
  44:Ourtasks/contactor_hv.c **** 
  45:Ourtasks/contactor_hv.c **** 			for (i = 0; i < NUMHV; i++)
  46:Ourtasks/contactor_hv.c **** 			{ 
  47:Ourtasks/contactor_hv.c **** 				/* Table lookup ASCII to binary: 4 asci -> uint16_t */
  48:Ourtasks/contactor_hv.c **** 				pcf->hv[i].hv  = \
  49:Ourtasks/contactor_hv.c ****                 (hxbn[*(pline+0)] <<  4) | \
  61              		.loc 1 49 0 discriminator 3
  62 001a 0B78     		ldrb	r3, [r1]	@ zero_extendqisi2
  63 001c 0D4C     		ldr	r4, .L8
  64 001e 14F803E0 		ldrb	lr, [r4, r3]	@ zero_extendqisi2
  50:Ourtasks/contactor_hv.c ****                 (hxbn[*(pline+1)] <<  0) | \
  65              		.loc 1 50 0 discriminator 3
ARM GAS  /tmp/ccl27WjO.s 			page 3


  66 0022 4B78     		ldrb	r3, [r1, #1]	@ zero_extendqisi2
  67 0024 E25C     		ldrb	r2, [r4, r3]	@ zero_extendqisi2
  51:Ourtasks/contactor_hv.c **** 				    (hxbn[*(pline+2)] << 12) | \
  68              		.loc 1 51 0 discriminator 3
  69 0026 8B78     		ldrb	r3, [r1, #2]	@ zero_extendqisi2
  70 0028 E35C     		ldrb	r3, [r4, r3]	@ zero_extendqisi2
  52:Ourtasks/contactor_hv.c ****                 (hxbn[*(pline+3)] <<  8);
  71              		.loc 1 52 0 discriminator 3
  72 002a CE78     		ldrb	r6, [r1, #3]	@ zero_extendqisi2
  73 002c A75D     		ldrb	r7, [r4, r6]	@ zero_extendqisi2
  48:Ourtasks/contactor_hv.c ****                 (hxbn[*(pline+0)] <<  4) | \
  74              		.loc 1 48 0 discriminator 3
  75 002e C0EBC006 		rsb	r6, r0, r0, lsl #3
  76 0032 F400     		lsls	r4, r6, #3
  77 0034 2C44     		add	r4, r4, r5
  78 0036 42EA0E12 		orr	r2, r2, lr, lsl #4
  79 003a 42EA0333 		orr	r3, r2, r3, lsl #12
  80 003e 43EA0723 		orr	r3, r3, r7, lsl #8
  81 0042 A4F89831 		strh	r3, [r4, #408]	@ movhi
  53:Ourtasks/contactor_hv.c **** 				pline += 4;
  82              		.loc 1 53 0 discriminator 3
  83 0046 0431     		adds	r1, r1, #4
  84              	.LVL5:
  45:Ourtasks/contactor_hv.c **** 			{ 
  85              		.loc 1 45 0 discriminator 3
  86 0048 0130     		adds	r0, r0, #1
  87              	.LVL6:
  88              	.L4:
  45:Ourtasks/contactor_hv.c **** 			{ 
  89              		.loc 1 45 0 is_stmt 0 discriminator 1
  90 004a 0228     		cmp	r0, #2
  91 004c E5DD     		ble	.L5
  92              	.LVL7:
  93              	.L2:
  54:Ourtasks/contactor_hv.c **** 			}
  55:Ourtasks/contactor_hv.c **** 		}
  56:Ourtasks/contactor_hv.c **** 	} while (pline != NULL); // Catchup jic we got behind
  94              		.loc 1 56 0 is_stmt 1
  95 004e 0029     		cmp	r1, #0
  96 0050 D8D1     		bne	.L6
  97              	.L1:
  98 0052 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
  99              	.LVL8:
 100              	.L9:
 101              		.align	2
 102              	.L8:
 103 0054 00000000 		.word	hxbn
 104              		.cfi_endproc
 105              	.LFE69:
 107              		.section	.text.contactor_hv_calibrate,"ax",%progbits
 108              		.align	2
 109              		.global	contactor_hv_calibrate
 110              		.thumb
 111              		.thumb_func
 113              	contactor_hv_calibrate:
 114              	.LFB70:
  57:Ourtasks/contactor_hv.c **** 	return;
ARM GAS  /tmp/ccl27WjO.s 			page 4


  58:Ourtasks/contactor_hv.c **** }
  59:Ourtasks/contactor_hv.c **** /* *************************************************************************
  60:Ourtasks/contactor_hv.c ****  * void contactor_hv_calibrate(struct CONTACTORFUNCTION* pcf);
  61:Ourtasks/contactor_hv.c ****  * @brief	: Apply calibration to raw readings
  62:Ourtasks/contactor_hv.c ****  * @return	: readings stored in contactor function struct
  63:Ourtasks/contactor_hv.c ****  * *************************************************************************/
  64:Ourtasks/contactor_hv.c **** void contactor_hv_calibrate(struct CONTACTORFUNCTION* pcf)
  65:Ourtasks/contactor_hv.c **** {
 115              		.loc 1 65 0
 116              		.cfi_startproc
 117              		@ args = 0, pretend = 0, frame = 0
 118              		@ frame_needed = 0, uses_anonymous_args = 0
 119              		@ link register save eliminated.
 120              	.LVL9:
 121 0000 10B4     		push	{r4}
 122              	.LCFI1:
 123              		.cfi_def_cfa_offset 4
 124              		.cfi_offset 4, -4
 125              	.LVL10:
  66:Ourtasks/contactor_hv.c **** 	int i;
  67:Ourtasks/contactor_hv.c **** 	for (i = 0; i < NUMHV; i++)
 126              		.loc 1 67 0
 127 0002 0022     		movs	r2, #0
 128 0004 0CE0     		b	.L11
 129              	.LVL11:
 130              	.L12:
  68:Ourtasks/contactor_hv.c **** 	{
  69:Ourtasks/contactor_hv.c **** 		/* Volts = Volts per ADC ct * Raw ADC ticks (16b) from uart */
  70:Ourtasks/contactor_hv.c **** 		pcf->hv[i].hvc = pcf->hv[i].hvcal * pcf->hv[i].hv;
 131              		.loc 1 70 0 discriminator 3
 132 0006 D100     		lsls	r1, r2, #3
 133 0008 891A     		subs	r1, r1, r2
 134 000a CB00     		lsls	r3, r1, #3
 135 000c 0344     		add	r3, r3, r0
 136 000e D3F89011 		ldr	r1, [r3, #400]
 137 0012 B3F89841 		ldrh	r4, [r3, #408]
 138 0016 01FB04F1 		mul	r1, r1, r4
 139 001a C3F89411 		str	r1, [r3, #404]
  67:Ourtasks/contactor_hv.c **** 	{
 140              		.loc 1 67 0 discriminator 3
 141 001e 0132     		adds	r2, r2, #1
 142              	.LVL12:
 143              	.L11:
  67:Ourtasks/contactor_hv.c **** 	{
 144              		.loc 1 67 0 is_stmt 0 discriminator 1
 145 0020 022A     		cmp	r2, #2
 146 0022 F0DD     		ble	.L12
  71:Ourtasks/contactor_hv.c **** 	}
  72:Ourtasks/contactor_hv.c **** 	return;
  73:Ourtasks/contactor_hv.c **** }
 147              		.loc 1 73 0 is_stmt 1
 148 0024 10BC     		pop	{r4}
 149              	.LCFI2:
 150              		.cfi_restore 4
 151              		.cfi_def_cfa_offset 0
 152 0026 7047     		bx	lr
 153              		.cfi_endproc
ARM GAS  /tmp/ccl27WjO.s 			page 5


 154              	.LFE70:
 156              		.text
 157              	.Letext0:
 158              		.file 2 "/home/deh/launchpad/gcc-arm-none-eabi-5_4-2016q3/arm-none-eabi/include/machine/_default_t
 159              		.file 3 "/home/deh/launchpad/gcc-arm-none-eabi-5_4-2016q3/arm-none-eabi/include/sys/_stdint.h"
 160              		.file 4 "Middlewares/Third_Party/FreeRTOS/Source/include/task.h"
 161              		.file 5 "Middlewares/Third_Party/FreeRTOS/Source/include/timers.h"
 162              		.file 6 "Middlewares/Third_Party/FreeRTOS/Source/CMSIS_RTOS/cmsis_os.h"
 163              		.file 7 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/stm32f103xb.h"
 164              		.file 8 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_def.h"
 165              		.file 9 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_dma.h"
 166              		.file 10 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_tim.h"
 167              		.file 11 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_uart.h"
 168              		.file 12 "Ourwares/common_misc.h"
 169              		.file 13 "Ourwares/common_can.h"
 170              		.file 14 "Ourtasks/iir_filter_lx.h"
 171              		.file 15 "Ourtasks/contactor_idx_v_struct.h"
 172              		.file 16 "Ourwares/CanTask.h"
 173              		.file 17 "Ourtasks/ContactorTask.h"
 174              		.file 18 "Ourwares/SerialTaskReceive.h"
 175              		.file 19 "Drivers/CMSIS/Include/core_cm3.h"
 176              		.file 20 "Ourwares/hexbin.h"
ARM GAS  /tmp/ccl27WjO.s 			page 6


DEFINED SYMBOLS
                            *ABS*:00000000 contactor_hv.c
     /tmp/ccl27WjO.s:20     .text.contactor_hv_uartline:00000000 $t
     /tmp/ccl27WjO.s:25     .text.contactor_hv_uartline:00000000 contactor_hv_uartline
     /tmp/ccl27WjO.s:103    .text.contactor_hv_uartline:00000054 $d
     /tmp/ccl27WjO.s:108    .text.contactor_hv_calibrate:00000000 $t
     /tmp/ccl27WjO.s:113    .text.contactor_hv_calibrate:00000000 contactor_hv_calibrate
                     .debug_frame:00000010 $d

UNDEFINED SYMBOLS
xSerialTaskReceiveGetline
hxbn
