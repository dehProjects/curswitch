ARM GAS  /tmp/ccfvuRS2.s 			page 1


   1              		.syntax unified
   2              		.cpu cortex-m3
   3              		.fpu softvfp
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.thumb
  14              		.syntax unified
  15              		.file	"contactor_msgs.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.section	.text.load4,"ax",%progbits
  20              		.align	2
  21              		.thumb
  22              		.thumb_func
  24              	load4:
  25              	.LFB73:
  26              		.file 1 "Ourtasks/contactor_msgs.c"
   1:Ourtasks/contactor_msgs.c **** /******************************************************************************
   2:Ourtasks/contactor_msgs.c **** * File Name          : contactor_msgs.c
   3:Ourtasks/contactor_msgs.c **** * Date First Issued  : 07/05/2019
   4:Ourtasks/contactor_msgs.c **** * Description        : Setup and send non-command function CAN msgs
   5:Ourtasks/contactor_msgs.c **** *******************************************************************************/
   6:Ourtasks/contactor_msgs.c **** /*
   7:Ourtasks/contactor_msgs.c **** SENT by contactor function:
   8:Ourtasks/contactor_msgs.c ****  (1) contactor command "cid_keepalive_r" (response to "cid_keepalive_i")
   9:Ourtasks/contactor_msgs.c ****      payload[0]
  10:Ourtasks/contactor_msgs.c ****        bit 7 - faulted (code in payload[2])
  11:Ourtasks/contactor_msgs.c ****        bit 6 - warning: minimum pre-chg immediate connect.
  12:Ourtasks/contactor_msgs.c ****               (warning bit only resets with power cycle)
  13:Ourtasks/contactor_msgs.c **** 		 bit[0]-[3]: Current main state code
  14:Ourtasks/contactor_msgs.c **** 
  15:Ourtasks/contactor_msgs.c ****      payload[1] = critical error state error code
  16:Ourtasks/contactor_msgs.c ****          0 = No fault
  17:Ourtasks/contactor_msgs.c ****          1 = battery string voltage (hv1) too low
  18:Ourtasks/contactor_msgs.c ****          2 = contactor 1 de-energized, aux1 closed
  19:Ourtasks/contactor_msgs.c ****          3 = contactor 2 de-energized, aux2 closed
  20:Ourtasks/contactor_msgs.c ****          4 = contactor #1 energized, after closure delay aux1 open
  21:Ourtasks/contactor_msgs.c ****          5 = contactor #2 energized, after closure delay aux2 open
  22:Ourtasks/contactor_msgs.c ****          6 = contactor #1 does not appear closed
  23:Ourtasks/contactor_msgs.c ****          7 = Timeout before pre-charge voltage reached cutoff
  24:Ourtasks/contactor_msgs.c ****          8 = Contactor #1 closed but voltage across it too big
  25:Ourtasks/contactor_msgs.c ****          9 = Contactor #2 closed but voltage across it too big
  26:Ourtasks/contactor_msgs.c **** 
  27:Ourtasks/contactor_msgs.c **** 		payload[2]
  28:Ourtasks/contactor_msgs.c ****          bit[0]-[3] - current substate CONNECTING code
  29:Ourtasks/contactor_msgs.c ****          bit[4]-[7] - current substate (spare) code
  30:Ourtasks/contactor_msgs.c **** 
  31:Ourtasks/contactor_msgs.c ****  poll  (response to "cid_gps_sync") & heartbeat
  32:Ourtasks/contactor_msgs.c ****  (2)  "cid_msg1" hv #1 : current #1  battery string voltage:current
ARM GAS  /tmp/ccfvuRS2.s 			page 2


  33:Ourtasks/contactor_msgs.c ****  (3)	"cid_msg2" hv #2 : hv #3       DMOC+:DMOC- voltages
  34:Ourtasks/contactor_msgs.c **** 
  35:Ourtasks/contactor_msgs.c ****  function command "cid_cmd_r"(response to "cid_cmd_i")
  36:Ourtasks/contactor_msgs.c ****  (4)  conditional on payload[0], for example(!)--
  37:Ourtasks/contactor_msgs.c ****       - ADC ct for calibration purposes hv1
  38:Ourtasks/contactor_msgs.c ****       - ADC ct for calibration purposes hv2
  39:Ourtasks/contactor_msgs.c ****       - ADC ct for calibration purposes hv3
  40:Ourtasks/contactor_msgs.c ****       - ADC ct for calibration purposes current1
  41:Ourtasks/contactor_msgs.c ****       - ADC ct for calibration purposes current2
  42:Ourtasks/contactor_msgs.c ****       - Duration: (Energize coil 1 - aux 1)
  43:Ourtasks/contactor_msgs.c ****       - Duration: (Energize coil 2 - aux 2)
  44:Ourtasks/contactor_msgs.c ****       - Duration: (Drop coil 1 - aux 1)
  45:Ourtasks/contactor_msgs.c ****       - Duration: (Drop coil 2 - aux 2)
  46:Ourtasks/contactor_msgs.c ****       - volts: 12v CAN supply
  47:Ourtasks/contactor_msgs.c ****       - volts: 5v regulated supply
  48:Ourtasks/contactor_msgs.c ****       ... (many and sundry)
  49:Ourtasks/contactor_msgs.c **** 
  50:Ourtasks/contactor_msgs.c ****  heartbeat (sent in absence of keep-alive msgs)
  51:Ourtasks/contactor_msgs.c ****  (5)  "cid_hb1" Same as (2) above
  52:Ourtasks/contactor_msgs.c ****  (6)  "cid_hb2" Same as (3) above
  53:Ourtasks/contactor_msgs.c **** */
  54:Ourtasks/contactor_msgs.c **** 
  55:Ourtasks/contactor_msgs.c **** #include "contactor_msgs.h"
  56:Ourtasks/contactor_msgs.c **** #include "MailboxTask.h"
  57:Ourtasks/contactor_msgs.c **** 
  58:Ourtasks/contactor_msgs.c **** static void hvpayload(struct CONTACTORFUNCTION* pcf, uint8_t idx1,uint8_t idx2,uint8_t idx3);
  59:Ourtasks/contactor_msgs.c **** static void load4(uint8_t *po, uint32_t n);
  60:Ourtasks/contactor_msgs.c **** 
  61:Ourtasks/contactor_msgs.c **** /* *************************************************************************
  62:Ourtasks/contactor_msgs.c ****  * void contactor_msg1(struct CONTACTORFUNCTION* pcf, uint8_t w);
  63:Ourtasks/contactor_msgs.c ****  *	@brief	: Setup and send responses: battery string voltage & battery current
  64:Ourtasks/contactor_msgs.c ****  * @param	: pcf = Pointer to working struct for Contactor function
  65:Ourtasks/contactor_msgs.c ****  * @param	: w = switch for CID_HB1 (0) or CID_MSG1 CAN ids (1)
  66:Ourtasks/contactor_msgs.c ****  * *************************************************************************/
  67:Ourtasks/contactor_msgs.c **** uint32_t dbgmsg1ctr;
  68:Ourtasks/contactor_msgs.c **** 
  69:Ourtasks/contactor_msgs.c **** void contactor_msg1(struct CONTACTORFUNCTION* pcf, uint8_t w)
  70:Ourtasks/contactor_msgs.c **** {
  71:Ourtasks/contactor_msgs.c **** 	// For loading float into payload
  72:Ourtasks/contactor_msgs.c **** 	union UIF
  73:Ourtasks/contactor_msgs.c **** 	{
  74:Ourtasks/contactor_msgs.c **** 		uint32_t ui;
  75:Ourtasks/contactor_msgs.c **** 		float    f;
  76:Ourtasks/contactor_msgs.c **** 	}tmp;
  77:Ourtasks/contactor_msgs.c **** 
  78:Ourtasks/contactor_msgs.c **** 	uint8_t idx2;
  79:Ourtasks/contactor_msgs.c **** 
  80:Ourtasks/contactor_msgs.c **** 	/* Use heartbeat or polled msg CAN id */
  81:Ourtasks/contactor_msgs.c **** 	if (w == 0) 
  82:Ourtasks/contactor_msgs.c **** 		idx2 = CID_HB1;
  83:Ourtasks/contactor_msgs.c **** 	else
  84:Ourtasks/contactor_msgs.c **** 		idx2 = CID_MSG1;
  85:Ourtasks/contactor_msgs.c **** 
  86:Ourtasks/contactor_msgs.c **** 	// Load Battery string voltage (IDXHV1) as first float in payload
  87:Ourtasks/contactor_msgs.c **** 	hvpayload(pcf, IDXHV1, idx2, 0);
  88:Ourtasks/contactor_msgs.c **** 
  89:Ourtasks/contactor_msgs.c **** 	// Battery string current as second float in payload
ARM GAS  /tmp/ccfvuRS2.s 			page 3


  90:Ourtasks/contactor_msgs.c **** 	double dI = (pcf->padc->cur1.iI * pcf->padc->cur1.dscale) / (1<<ADCSCALEbits);
  91:Ourtasks/contactor_msgs.c **** 	tmp.f = dI; // Convert to float
  92:Ourtasks/contactor_msgs.c **** 	load4(&pcf->canmsg[idx2].can.cd.uc[4],tmp.ui); // Load float
  93:Ourtasks/contactor_msgs.c **** 
  94:Ourtasks/contactor_msgs.c **** 	pcf->canmsg[idx2].can.dlc = 8;
  95:Ourtasks/contactor_msgs.c **** 
  96:Ourtasks/contactor_msgs.c **** dbgmsg1ctr += 1;
  97:Ourtasks/contactor_msgs.c **** 
  98:Ourtasks/contactor_msgs.c **** 	// Queue CAN msg
  99:Ourtasks/contactor_msgs.c **** 	xQueueSendToBack(CanTxQHandle,&pcf->canmsg[idx2],portMAX_DELAY);
 100:Ourtasks/contactor_msgs.c **** 	return;
 101:Ourtasks/contactor_msgs.c **** 
 102:Ourtasks/contactor_msgs.c **** }
 103:Ourtasks/contactor_msgs.c **** /* *************************************************************************
 104:Ourtasks/contactor_msgs.c ****  * void contactor_msg2(struct CONTACTORFUNCTION* pcf, uint8_t w);
 105:Ourtasks/contactor_msgs.c ****  *	@brief	: Setup and send responses: voltages: DMOC+, DMOC-
 106:Ourtasks/contactor_msgs.c ****  * @param	: pcf = Pointer to working struct for Contactor function
 107:Ourtasks/contactor_msgs.c ****  * @param	: w = switch for CID_HB1 (0) or CID_MSG1 CAN ids (1)
 108:Ourtasks/contactor_msgs.c ****  * *************************************************************************/
 109:Ourtasks/contactor_msgs.c **** void contactor_msg2(struct CONTACTORFUNCTION* pcf, uint8_t w)
 110:Ourtasks/contactor_msgs.c **** {
 111:Ourtasks/contactor_msgs.c **** 	uint8_t idx2;
 112:Ourtasks/contactor_msgs.c **** dbgmsg1ctr += 1;
 113:Ourtasks/contactor_msgs.c **** 
 114:Ourtasks/contactor_msgs.c **** 	if (w == 0) 
 115:Ourtasks/contactor_msgs.c **** 		idx2 = CID_HB2;
 116:Ourtasks/contactor_msgs.c **** 	else
 117:Ourtasks/contactor_msgs.c **** 		idx2 = CID_MSG2;
 118:Ourtasks/contactor_msgs.c **** 
 119:Ourtasks/contactor_msgs.c **** 	// Load high voltage 2 as a float into payload
 120:Ourtasks/contactor_msgs.c **** 	hvpayload(pcf, IDXHV2, idx2, 0);
 121:Ourtasks/contactor_msgs.c **** 
 122:Ourtasks/contactor_msgs.c **** 	// Load high voltage 3 as a float into payload
 123:Ourtasks/contactor_msgs.c **** 	hvpayload(pcf, IDXHV3, idx2, 4);
 124:Ourtasks/contactor_msgs.c **** 
 125:Ourtasks/contactor_msgs.c **** 	// Queue CAN msg
 126:Ourtasks/contactor_msgs.c **** 	xQueueSendToBack(CanTxQHandle,&pcf->canmsg[idx2],portMAX_DELAY);
 127:Ourtasks/contactor_msgs.c **** 	return;
 128:Ourtasks/contactor_msgs.c **** }
 129:Ourtasks/contactor_msgs.c **** /* *************************************************************************
 130:Ourtasks/contactor_msgs.c ****  * static void hvpayload(struct CONTACTORFUNCTION* pcf, uint8_t idx1,uint8_t idx2,uint8_t idx3);
 131:Ourtasks/contactor_msgs.c ****  *	@brief	: Setup and send responses: voltages: DMOC+, DMOC-
 132:Ourtasks/contactor_msgs.c ****  * @param	: pcf = Pointer to working struct for Contactor function
 133:Ourtasks/contactor_msgs.c ****  * @param	: idx1 = index into hv array (0-(NUMHV-1))
 134:Ourtasks/contactor_msgs.c ****  * @param	: idx2 = index into ncan msg (0-(NUMCANMSGS-1))
 135:Ourtasks/contactor_msgs.c ****  * @param	: idx3 = index into payload byte array
 136:Ourtasks/contactor_msgs.c ****  * *************************************************************************/
 137:Ourtasks/contactor_msgs.c **** static void hvpayload(struct CONTACTORFUNCTION* pcf, uint8_t idx1,uint8_t idx2,uint8_t idx3)
 138:Ourtasks/contactor_msgs.c **** {
 139:Ourtasks/contactor_msgs.c **** 	union UIF
 140:Ourtasks/contactor_msgs.c **** 	{
 141:Ourtasks/contactor_msgs.c **** 		uint32_t ui;
 142:Ourtasks/contactor_msgs.c **** 		float    f;
 143:Ourtasks/contactor_msgs.c **** 	}tmp;
 144:Ourtasks/contactor_msgs.c **** 
 145:Ourtasks/contactor_msgs.c **** 	// Load high voltage [idx1] as a float into payload msg [idx2] payload byte [idx3]
 146:Ourtasks/contactor_msgs.c **** 	pcf->hv[idx1].dhvc = (double)pcf->hv[idx1].dscale * (double)pcf->hv[idx1].hv;
ARM GAS  /tmp/ccfvuRS2.s 			page 4


 147:Ourtasks/contactor_msgs.c **** 	tmp.f = pcf->hv[idx1].dhvc;                       // Convert to float
 148:Ourtasks/contactor_msgs.c **** 	load4(&pcf->canmsg[idx2].can.cd.uc[idx3],tmp.ui); // Load payload
 149:Ourtasks/contactor_msgs.c **** 	return;
 150:Ourtasks/contactor_msgs.c **** }
 151:Ourtasks/contactor_msgs.c **** /* *************************************************************************
 152:Ourtasks/contactor_msgs.c ****  * void contactor_msg_ka(struct CONTACTORFUNCTION* pcf);
 153:Ourtasks/contactor_msgs.c ****  *	@brief	: Setup and send Keep-alive response
 154:Ourtasks/contactor_msgs.c ****  * @param	: pcf = Pointer to working struct for Contactor function
 155:Ourtasks/contactor_msgs.c ****  * *************************************************************************/
 156:Ourtasks/contactor_msgs.c **** uint32_t dbgkactr;
 157:Ourtasks/contactor_msgs.c **** void contactor_msg_ka(struct CONTACTORFUNCTION* pcf)
 158:Ourtasks/contactor_msgs.c **** {
 159:Ourtasks/contactor_msgs.c **** dbgkactr += 1;
 160:Ourtasks/contactor_msgs.c **** 	/* Return command byte w primary state code */
 161:Ourtasks/contactor_msgs.c **** 	pcf->canmsg[CID_KA_R].can.cd.uc[0]  = 
 162:Ourtasks/contactor_msgs.c ****      (pcf->pmbx_cid_keepalive_i->ncan.can.cd.uc[0] & 0xf0) |
 163:Ourtasks/contactor_msgs.c ****      (pcf->state & 0xf);
 164:Ourtasks/contactor_msgs.c **** 
 165:Ourtasks/contactor_msgs.c **** 	/* Fault code */
 166:Ourtasks/contactor_msgs.c **** 	pcf->canmsg[CID_KA_R].can.cd.uc[1] = pcf->faultcode;
 167:Ourtasks/contactor_msgs.c **** 
 168:Ourtasks/contactor_msgs.c **** 	/* substate codes */
 169:Ourtasks/contactor_msgs.c **** 	pcf->canmsg[CID_KA_R].can.cd.uc[2]  = (pcf->substateC << 0) & 0xf;
 170:Ourtasks/contactor_msgs.c **** 	pcf->canmsg[CID_KA_R].can.cd.uc[2] |= (pcf->substateX << 4);
 171:Ourtasks/contactor_msgs.c **** 
 172:Ourtasks/contactor_msgs.c **** 	pcf->canmsg[CID_KA_R].can.dlc = 3; // Payload size
 173:Ourtasks/contactor_msgs.c **** 
 174:Ourtasks/contactor_msgs.c **** 	// Queue CAN msg
 175:Ourtasks/contactor_msgs.c **** 	xQueueSendToBack(CanTxQHandle,&pcf->canmsg[CID_KA_R],portMAX_DELAY);
 176:Ourtasks/contactor_msgs.c **** 	return;
 177:Ourtasks/contactor_msgs.c **** }
 178:Ourtasks/contactor_msgs.c **** /* *************************************************************************
 179:Ourtasks/contactor_msgs.c ****  * static void load4(uint8_t *po, uint32_t n);
 180:Ourtasks/contactor_msgs.c ****  *	@brief	: Copy uint32_t into byte array (not aligned)
 181:Ourtasks/contactor_msgs.c ****  * *************************************************************************/
 182:Ourtasks/contactor_msgs.c **** static void load4(uint8_t *po, uint32_t n)
 183:Ourtasks/contactor_msgs.c **** {
  27              		.loc 1 183 0
  28              		.cfi_startproc
  29              		@ args = 0, pretend = 0, frame = 0
  30              		@ frame_needed = 0, uses_anonymous_args = 0
  31              		@ link register save eliminated.
  32              	.LVL0:
 184:Ourtasks/contactor_msgs.c **** 	*(po + 0) = (n >>  0);
  33              		.loc 1 184 0
  34 0000 0170     		strb	r1, [r0]
 185:Ourtasks/contactor_msgs.c **** 	*(po + 1) = (n >>  8);
  35              		.loc 1 185 0
  36 0002 0B0A     		lsrs	r3, r1, #8
  37 0004 4370     		strb	r3, [r0, #1]
 186:Ourtasks/contactor_msgs.c **** 	*(po + 2) = (n >> 16);
  38              		.loc 1 186 0
  39 0006 0B0C     		lsrs	r3, r1, #16
  40 0008 8370     		strb	r3, [r0, #2]
 187:Ourtasks/contactor_msgs.c **** 	*(po + 3) = (n >> 24);
  41              		.loc 1 187 0
  42 000a 090E     		lsrs	r1, r1, #24
ARM GAS  /tmp/ccfvuRS2.s 			page 5


  43              	.LVL1:
  44 000c C170     		strb	r1, [r0, #3]
  45 000e 7047     		bx	lr
  46              		.cfi_endproc
  47              	.LFE73:
  49              		.global	__aeabi_ui2d
  50              		.global	__aeabi_dmul
  51              		.global	__aeabi_d2f
  52              		.section	.text.hvpayload,"ax",%progbits
  53              		.align	2
  54              		.thumb
  55              		.thumb_func
  57              	hvpayload:
  58              	.LFB71:
 138:Ourtasks/contactor_msgs.c **** 	union UIF
  59              		.loc 1 138 0
  60              		.cfi_startproc
  61              		@ args = 0, pretend = 0, frame = 0
  62              		@ frame_needed = 0, uses_anonymous_args = 0
  63              	.LVL2:
  64 0000 2DE9F047 		push	{r4, r5, r6, r7, r8, r9, r10, lr}
  65              	.LCFI0:
  66              		.cfi_def_cfa_offset 32
  67              		.cfi_offset 4, -32
  68              		.cfi_offset 5, -28
  69              		.cfi_offset 6, -24
  70              		.cfi_offset 7, -20
  71              		.cfi_offset 8, -16
  72              		.cfi_offset 9, -12
  73              		.cfi_offset 10, -8
  74              		.cfi_offset 14, -4
  75 0004 0546     		mov	r5, r0
  76 0006 8A46     		mov	r10, r1
  77 0008 1646     		mov	r6, r2
  78 000a 1C46     		mov	r4, r3
 146:Ourtasks/contactor_msgs.c **** 	tmp.f = pcf->hv[idx1].dhvc;                       // Convert to float
  79              		.loc 1 146 0
  80 000c CF00     		lsls	r7, r1, #3
  81 000e 7A1A     		subs	r2, r7, r1
  82              	.LVL3:
  83 0010 D300     		lsls	r3, r2, #3
  84              	.LVL4:
  85 0012 0344     		add	r3, r3, r0
  86 0014 03F5C072 		add	r2, r3, #384
  87 0018 D2E90089 		ldrd	r8, [r2]
  88 001c B3F89801 		ldrh	r0, [r3, #408]
  89              	.LVL5:
  90 0020 FFF7FEFF 		bl	__aeabi_ui2d
  91              	.LVL6:
  92 0024 0246     		mov	r2, r0
  93 0026 0B46     		mov	r3, r1
  94 0028 4046     		mov	r0, r8
  95 002a 4946     		mov	r1, r9
  96 002c FFF7FEFF 		bl	__aeabi_dmul
  97              	.LVL7:
  98 0030 CAEB0707 		rsb	r7, r10, r7
  99 0034 FB00     		lsls	r3, r7, #3
ARM GAS  /tmp/ccfvuRS2.s 			page 6


 100 0036 2B44     		add	r3, r3, r5
 101 0038 03F5C473 		add	r3, r3, #392
 102 003c C3E90001 		strd	r0, [r3]
 147:Ourtasks/contactor_msgs.c **** 	load4(&pcf->canmsg[idx2].can.cd.uc[idx3],tmp.ui); // Load payload
 103              		.loc 1 147 0
 104 0040 FFF7FEFF 		bl	__aeabi_d2f
 105              	.LVL8:
 148:Ourtasks/contactor_msgs.c **** 	return;
 106              		.loc 1 148 0
 107 0044 04EB4614 		add	r4, r4, r6, lsl #5
 108 0048 04F51674 		add	r4, r4, #600
 109 004c 0146     		mov	r1, r0
 110 004e 2819     		adds	r0, r5, r4
 111 0050 FFF7FEFF 		bl	load4
 112              	.LVL9:
 113 0054 BDE8F087 		pop	{r4, r5, r6, r7, r8, r9, r10, pc}
 114              		.cfi_endproc
 115              	.LFE71:
 117              		.global	__aeabi_i2d
 118              		.section	.text.contactor_msg1,"ax",%progbits
 119              		.align	2
 120              		.global	contactor_msg1
 121              		.thumb
 122              		.thumb_func
 124              	contactor_msg1:
 125              	.LFB69:
  70:Ourtasks/contactor_msgs.c **** 	// For loading float into payload
 126              		.loc 1 70 0
 127              		.cfi_startproc
 128              		@ args = 0, pretend = 0, frame = 0
 129              		@ frame_needed = 0, uses_anonymous_args = 0
 130              	.LVL10:
 131 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 132              	.LCFI1:
 133              		.cfi_def_cfa_offset 24
 134              		.cfi_offset 3, -24
 135              		.cfi_offset 4, -20
 136              		.cfi_offset 5, -16
 137              		.cfi_offset 6, -12
 138              		.cfi_offset 7, -8
 139              		.cfi_offset 14, -4
 140 0002 0546     		mov	r5, r0
  81:Ourtasks/contactor_msgs.c **** 		idx2 = CID_HB1;
 141              		.loc 1 81 0
 142 0004 09B9     		cbnz	r1, .L6
  82:Ourtasks/contactor_msgs.c **** 	else
 143              		.loc 1 82 0
 144 0006 0424     		movs	r4, #4
 145 0008 00E0     		b	.L5
 146              	.L6:
  84:Ourtasks/contactor_msgs.c **** 
 147              		.loc 1 84 0
 148 000a 0124     		movs	r4, #1
 149              	.L5:
 150              	.LVL11:
  87:Ourtasks/contactor_msgs.c **** 
 151              		.loc 1 87 0
ARM GAS  /tmp/ccfvuRS2.s 			page 7


 152 000c 0023     		movs	r3, #0
 153 000e 2246     		mov	r2, r4
 154 0010 1946     		mov	r1, r3
 155              	.LVL12:
 156 0012 2846     		mov	r0, r5
 157              	.LVL13:
 158 0014 FFF7FEFF 		bl	hvpayload
 159              	.LVL14:
  90:Ourtasks/contactor_msgs.c **** 	tmp.f = dI; // Convert to float
 160              		.loc 1 90 0
 161 0018 D5F8E830 		ldr	r3, [r5, #232]
 162 001c 03F5E472 		add	r2, r3, #456
 163 0020 D2E90067 		ldrd	r6, [r2]
 164 0024 D3F8D801 		ldr	r0, [r3, #472]
 165 0028 FFF7FEFF 		bl	__aeabi_i2d
 166              	.LVL15:
 167 002c 3246     		mov	r2, r6
 168 002e 3B46     		mov	r3, r7
 169 0030 FFF7FEFF 		bl	__aeabi_dmul
 170              	.LVL16:
 171 0034 0022     		movs	r2, #0
 172 0036 4FF07C53 		mov	r3, #1056964608
 173 003a FFF7FEFF 		bl	__aeabi_dmul
 174              	.LVL17:
  91:Ourtasks/contactor_msgs.c **** 	load4(&pcf->canmsg[idx2].can.cd.uc[4],tmp.ui); // Load float
 175              		.loc 1 91 0
 176 003e FFF7FEFF 		bl	__aeabi_d2f
 177              	.LVL18:
  92:Ourtasks/contactor_msgs.c **** 
 178              		.loc 1 92 0
 179 0042 6401     		lsls	r4, r4, #5
 180              	.LVL19:
 181 0044 04F51773 		add	r3, r4, #604
 182 0048 0146     		mov	r1, r0
 183 004a E818     		adds	r0, r5, r3
 184 004c FFF7FEFF 		bl	load4
 185              	.LVL20:
  94:Ourtasks/contactor_msgs.c **** 
 186              		.loc 1 94 0
 187 0050 2B19     		adds	r3, r5, r4
 188 0052 0822     		movs	r2, #8
 189 0054 C3F85422 		str	r2, [r3, #596]
  96:Ourtasks/contactor_msgs.c **** 
 190              		.loc 1 96 0
 191 0058 074A     		ldr	r2, .L8
 192 005a 1368     		ldr	r3, [r2]
 193 005c 0133     		adds	r3, r3, #1
 194 005e 1360     		str	r3, [r2]
  99:Ourtasks/contactor_msgs.c **** 	return;
 195              		.loc 1 99 0
 196 0060 04F51271 		add	r1, r4, #584
 197 0064 0023     		movs	r3, #0
 198 0066 4FF0FF32 		mov	r2, #-1
 199 006a 2944     		add	r1, r1, r5
 200 006c 0348     		ldr	r0, .L8+4
 201 006e 0068     		ldr	r0, [r0]
 202 0070 FFF7FEFF 		bl	xQueueGenericSend
ARM GAS  /tmp/ccfvuRS2.s 			page 8


 203              	.LVL21:
 204 0074 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 205              	.LVL22:
 206              	.L9:
 207 0076 00BF     		.align	2
 208              	.L8:
 209 0078 00000000 		.word	dbgmsg1ctr
 210 007c 00000000 		.word	CanTxQHandle
 211              		.cfi_endproc
 212              	.LFE69:
 214              		.section	.text.contactor_msg2,"ax",%progbits
 215              		.align	2
 216              		.global	contactor_msg2
 217              		.thumb
 218              		.thumb_func
 220              	contactor_msg2:
 221              	.LFB70:
 110:Ourtasks/contactor_msgs.c **** 	uint8_t idx2;
 222              		.loc 1 110 0
 223              		.cfi_startproc
 224              		@ args = 0, pretend = 0, frame = 0
 225              		@ frame_needed = 0, uses_anonymous_args = 0
 226              	.LVL23:
 227 0000 38B5     		push	{r3, r4, r5, lr}
 228              	.LCFI2:
 229              		.cfi_def_cfa_offset 16
 230              		.cfi_offset 3, -16
 231              		.cfi_offset 4, -12
 232              		.cfi_offset 5, -8
 233              		.cfi_offset 14, -4
 234 0002 0546     		mov	r5, r0
 112:Ourtasks/contactor_msgs.c **** 
 235              		.loc 1 112 0
 236 0004 0F4A     		ldr	r2, .L14
 237 0006 1368     		ldr	r3, [r2]
 238 0008 0133     		adds	r3, r3, #1
 239 000a 1360     		str	r3, [r2]
 114:Ourtasks/contactor_msgs.c **** 		idx2 = CID_HB2;
 240              		.loc 1 114 0
 241 000c 09B9     		cbnz	r1, .L12
 115:Ourtasks/contactor_msgs.c **** 	else
 242              		.loc 1 115 0
 243 000e 0524     		movs	r4, #5
 244 0010 00E0     		b	.L11
 245              	.L12:
 117:Ourtasks/contactor_msgs.c **** 
 246              		.loc 1 117 0
 247 0012 0224     		movs	r4, #2
 248              	.L11:
 249              	.LVL24:
 120:Ourtasks/contactor_msgs.c **** 
 250              		.loc 1 120 0
 251 0014 0023     		movs	r3, #0
 252 0016 2246     		mov	r2, r4
 253 0018 0121     		movs	r1, #1
 254              	.LVL25:
 255 001a 2846     		mov	r0, r5
ARM GAS  /tmp/ccfvuRS2.s 			page 9


 256              	.LVL26:
 257 001c FFF7FEFF 		bl	hvpayload
 258              	.LVL27:
 123:Ourtasks/contactor_msgs.c **** 
 259              		.loc 1 123 0
 260 0020 0423     		movs	r3, #4
 261 0022 2246     		mov	r2, r4
 262 0024 0221     		movs	r1, #2
 263 0026 2846     		mov	r0, r5
 264 0028 FFF7FEFF 		bl	hvpayload
 265              	.LVL28:
 126:Ourtasks/contactor_msgs.c **** 	return;
 266              		.loc 1 126 0
 267 002c 6101     		lsls	r1, r4, #5
 268 002e 01F51271 		add	r1, r1, #584
 269 0032 0023     		movs	r3, #0
 270 0034 4FF0FF32 		mov	r2, #-1
 271 0038 2944     		add	r1, r1, r5
 272 003a 0348     		ldr	r0, .L14+4
 273 003c 0068     		ldr	r0, [r0]
 274 003e FFF7FEFF 		bl	xQueueGenericSend
 275              	.LVL29:
 276 0042 38BD     		pop	{r3, r4, r5, pc}
 277              	.LVL30:
 278              	.L15:
 279              		.align	2
 280              	.L14:
 281 0044 00000000 		.word	dbgmsg1ctr
 282 0048 00000000 		.word	CanTxQHandle
 283              		.cfi_endproc
 284              	.LFE70:
 286              		.section	.text.contactor_msg_ka,"ax",%progbits
 287              		.align	2
 288              		.global	contactor_msg_ka
 289              		.thumb
 290              		.thumb_func
 292              	contactor_msg_ka:
 293              	.LFB72:
 158:Ourtasks/contactor_msgs.c **** dbgkactr += 1;
 294              		.loc 1 158 0
 295              		.cfi_startproc
 296              		@ args = 0, pretend = 0, frame = 0
 297              		@ frame_needed = 0, uses_anonymous_args = 0
 298              	.LVL31:
 299 0000 08B5     		push	{r3, lr}
 300              	.LCFI3:
 301              		.cfi_def_cfa_offset 8
 302              		.cfi_offset 3, -8
 303              		.cfi_offset 14, -4
 159:Ourtasks/contactor_msgs.c **** 	/* Return command byte w primary state code */
 304              		.loc 1 159 0
 305 0002 154A     		ldr	r2, .L18
 306 0004 1368     		ldr	r3, [r2]
 307 0006 0133     		adds	r3, r3, #1
 308 0008 1360     		str	r3, [r2]
 162:Ourtasks/contactor_msgs.c ****      (pcf->state & 0xf);
 309              		.loc 1 162 0
ARM GAS  /tmp/ccfvuRS2.s 			page 10


 310 000a D0F81832 		ldr	r3, [r0, #536]
 311 000e 1A7A     		ldrb	r2, [r3, #8]	@ zero_extendqisi2
 163:Ourtasks/contactor_msgs.c **** 
 312              		.loc 1 163 0
 313 0010 90F84432 		ldrb	r3, [r0, #580]	@ zero_extendqisi2
 161:Ourtasks/contactor_msgs.c ****      (pcf->pmbx_cid_keepalive_i->ncan.can.cd.uc[0] & 0xf0) |
 314              		.loc 1 161 0
 315 0014 22F00F02 		bic	r2, r2, #15
 316 0018 03F00F03 		and	r3, r3, #15
 317 001c 1343     		orrs	r3, r3, r2
 318 001e 80F85832 		strb	r3, [r0, #600]
 166:Ourtasks/contactor_msgs.c **** 
 319              		.loc 1 166 0
 320 0022 90F8F830 		ldrb	r3, [r0, #248]	@ zero_extendqisi2
 321 0026 80F85932 		strb	r3, [r0, #601]
 169:Ourtasks/contactor_msgs.c **** 	pcf->canmsg[CID_KA_R].can.cd.uc[2] |= (pcf->substateX << 4);
 322              		.loc 1 169 0
 323 002a 90F84532 		ldrb	r3, [r0, #581]	@ zero_extendqisi2
 324 002e 03F00F03 		and	r3, r3, #15
 170:Ourtasks/contactor_msgs.c **** 
 325              		.loc 1 170 0
 326 0032 90F84622 		ldrb	r2, [r0, #582]	@ zero_extendqisi2
 327 0036 43EA0213 		orr	r3, r3, r2, lsl #4
 328 003a 80F85A32 		strb	r3, [r0, #602]
 172:Ourtasks/contactor_msgs.c **** 
 329              		.loc 1 172 0
 330 003e 0323     		movs	r3, #3
 331 0040 C0F85432 		str	r3, [r0, #596]
 175:Ourtasks/contactor_msgs.c **** 	return;
 332              		.loc 1 175 0
 333 0044 0023     		movs	r3, #0
 334 0046 4FF0FF32 		mov	r2, #-1
 335 004a 00F51271 		add	r1, r0, #584
 336 004e 0348     		ldr	r0, .L18+4
 337              	.LVL32:
 338 0050 0068     		ldr	r0, [r0]
 339 0052 FFF7FEFF 		bl	xQueueGenericSend
 340              	.LVL33:
 341 0056 08BD     		pop	{r3, pc}
 342              	.L19:
 343              		.align	2
 344              	.L18:
 345 0058 00000000 		.word	dbgkactr
 346 005c 00000000 		.word	CanTxQHandle
 347              		.cfi_endproc
 348              	.LFE72:
 350              		.comm	dbgkactr,4,4
 351              		.comm	dbgmsg1ctr,4,4
 352              		.text
 353              	.Letext0:
 354              		.file 2 "/home/deh/launchpad/gcc-arm-none-eabi-5_4-2016q3/arm-none-eabi/include/machine/_default_t
 355              		.file 3 "/home/deh/launchpad/gcc-arm-none-eabi-5_4-2016q3/arm-none-eabi/include/sys/_stdint.h"
 356              		.file 4 "Middlewares/Third_Party/FreeRTOS/Source/portable/GCC/ARM_CM3/portmacro.h"
 357              		.file 5 "Middlewares/Third_Party/FreeRTOS/Source/include/task.h"
 358              		.file 6 "Ourwares/common_misc.h"
 359              		.file 7 "Ourwares/common_can.h"
 360              		.file 8 "Ourtasks/iir_filter_lx.h"
ARM GAS  /tmp/ccfvuRS2.s 			page 11


 361              		.file 9 "Middlewares/Third_Party/FreeRTOS/Source/include/timers.h"
 362              		.file 10 "Middlewares/Third_Party/FreeRTOS/Source/include/queue.h"
 363              		.file 11 "Middlewares/Third_Party/FreeRTOS/Source/CMSIS_RTOS/cmsis_os.h"
 364              		.file 12 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/stm32f103xb.h"
 365              		.file 13 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/stm32f1xx.h"
 366              		.file 14 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_can.h"
 367              		.file 15 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_tim.h"
 368              		.file 16 "Ourtasks/contactor_idx_v_struct.h"
 369              		.file 17 "Ourtasks/adc_idx_v_struct.h"
 370              		.file 18 "Ourwares/CanTask.h"
 371              		.file 19 "Ourwares/can_iface.h"
 372              		.file 20 "Ourtasks/ContactorTask.h"
 373              		.file 21 "Ourtasks/adcparams.h"
 374              		.file 22 "Ourwares/MailboxTask.h"
 375              		.file 23 "Ourtasks/cic_filter_l_N2_M3.h"
 376              		.file 24 "Drivers/CMSIS/Include/core_cm3.h"
ARM GAS  /tmp/ccfvuRS2.s 			page 12


DEFINED SYMBOLS
                            *ABS*:00000000 contactor_msgs.c
     /tmp/ccfvuRS2.s:20     .text.load4:00000000 $t
     /tmp/ccfvuRS2.s:24     .text.load4:00000000 load4
     /tmp/ccfvuRS2.s:53     .text.hvpayload:00000000 $t
     /tmp/ccfvuRS2.s:57     .text.hvpayload:00000000 hvpayload
     /tmp/ccfvuRS2.s:119    .text.contactor_msg1:00000000 $t
     /tmp/ccfvuRS2.s:124    .text.contactor_msg1:00000000 contactor_msg1
     /tmp/ccfvuRS2.s:209    .text.contactor_msg1:00000078 $d
                            *COM*:00000004 dbgmsg1ctr
     /tmp/ccfvuRS2.s:215    .text.contactor_msg2:00000000 $t
     /tmp/ccfvuRS2.s:220    .text.contactor_msg2:00000000 contactor_msg2
     /tmp/ccfvuRS2.s:281    .text.contactor_msg2:00000044 $d
     /tmp/ccfvuRS2.s:287    .text.contactor_msg_ka:00000000 $t
     /tmp/ccfvuRS2.s:292    .text.contactor_msg_ka:00000000 contactor_msg_ka
     /tmp/ccfvuRS2.s:345    .text.contactor_msg_ka:00000058 $d
                            *COM*:00000004 dbgkactr
                     .debug_frame:00000010 $d

UNDEFINED SYMBOLS
__aeabi_ui2d
__aeabi_dmul
__aeabi_d2f
__aeabi_i2d
xQueueGenericSend
CanTxQHandle
