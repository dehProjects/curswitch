ARM GAS  /tmp/ccUZsBcp.s 			page 1


   1              		.syntax unified
   2              		.cpu cortex-m3
   3              		.fpu softvfp
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.thumb
  14              		.syntax unified
  15              		.file	"ContactorUpdates.c"
  16              		.text
  17              	.Ltext0:
  18              		.cfi_sections	.debug_frame
  19              		.section	.text.ContactorUpdates,"ax",%progbits
  20              		.align	2
  21              		.global	ContactorUpdates
  22              		.thumb
  23              		.thumb_func
  25              	ContactorUpdates:
  26              	.LFB69:
  27              		.file 1 "Ourtasks/ContactorUpdates.c"
   1:Ourtasks/ContactorUpdates.c **** /******************************************************************************
   2:Ourtasks/ContactorUpdates.c **** * File Name          : ContactorUpdates.c
   3:Ourtasks/ContactorUpdates.c **** * Date First Issued  : 07/02/2019
   4:Ourtasks/ContactorUpdates.c **** * Description        : Update outputs in Contactor function w STM32CubeMX w FreeRTOS
   5:Ourtasks/ContactorUpdates.c **** *******************************************************************************/
   6:Ourtasks/ContactorUpdates.c **** 
   7:Ourtasks/ContactorUpdates.c **** #include "FreeRTOS.h"
   8:Ourtasks/ContactorUpdates.c **** #include "task.h"
   9:Ourtasks/ContactorUpdates.c **** #include "cmsis_os.h"
  10:Ourtasks/ContactorUpdates.c **** #include "malloc.h"
  11:Ourtasks/ContactorUpdates.c **** #include "ADCTask.h"
  12:Ourtasks/ContactorUpdates.c **** #include "adctask.h"
  13:Ourtasks/ContactorUpdates.c **** 
  14:Ourtasks/ContactorUpdates.c **** #include "ContactorTask.h"
  15:Ourtasks/ContactorUpdates.c **** #include "contactor_idx_v_struct.h"
  16:Ourtasks/ContactorUpdates.c **** #include "CanTask.h"
  17:Ourtasks/ContactorUpdates.c **** #include "contactor_msgs.h"
  18:Ourtasks/ContactorUpdates.c **** 
  19:Ourtasks/ContactorUpdates.c **** #include "morse.h"
  20:Ourtasks/ContactorUpdates.c **** 
  21:Ourtasks/ContactorUpdates.c **** /* From 'main.c' */
  22:Ourtasks/ContactorUpdates.c **** extern UART_HandleTypeDef huart3;
  23:Ourtasks/ContactorUpdates.c **** extern TIM_HandleTypeDef htim3;
  24:Ourtasks/ContactorUpdates.c **** extern TIM_HandleTypeDef htim4;
  25:Ourtasks/ContactorUpdates.c **** 
  26:Ourtasks/ContactorUpdates.c **** /* *************************************************************************
  27:Ourtasks/ContactorUpdates.c ****  * void ContactorUpdates(struct CONTACTORFUNCTION* pcf);
  28:Ourtasks/ContactorUpdates.c ****  * @brief	: Update outputs based on bits set
  29:Ourtasks/ContactorUpdates.c ****  * *************************************************************************/
  30:Ourtasks/ContactorUpdates.c **** void ContactorUpdates(struct CONTACTORFUNCTION* pcf)
  31:Ourtasks/ContactorUpdates.c **** {
ARM GAS  /tmp/ccUZsBcp.s 			page 2


  28              		.loc 1 31 0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              	.LVL0:
  33 0000 38B5     		push	{r3, r4, r5, lr}
  34              	.LCFI0:
  35              		.cfi_def_cfa_offset 16
  36              		.cfi_offset 3, -16
  37              		.cfi_offset 4, -12
  38              		.cfi_offset 5, -8
  39              		.cfi_offset 14, -4
  40 0002 0446     		mov	r4, r0
  32:Ourtasks/ContactorUpdates.c **** 	/* Reset new ADC readings flag. */
  33:Ourtasks/ContactorUpdates.c **** 	if ((pcf->evstat & CNCTEVADC) != 0)
  41              		.loc 1 33 0
  42 0004 D0F8EC30 		ldr	r3, [r0, #236]
  43 0008 13F4007F 		tst	r3, #512
  44 000c 03D0     		beq	.L2
  34:Ourtasks/ContactorUpdates.c **** 	{
  35:Ourtasks/ContactorUpdates.c **** 			pcf->evstat &= ~CNCTEVADC;
  45              		.loc 1 35 0
  46 000e 23F40073 		bic	r3, r3, #512
  47 0012 C0F8EC30 		str	r3, [r0, #236]
  48              	.L2:
  36:Ourtasks/ContactorUpdates.c **** 	}
  37:Ourtasks/ContactorUpdates.c **** 
  38:Ourtasks/ContactorUpdates.c **** 	/* Queue keep-alive status CAN msg */
  39:Ourtasks/ContactorUpdates.c **** 	if ((pcf->outstat & CNCTOUT05KA) != 0)
  49              		.loc 1 39 0
  50 0016 D4F8F030 		ldr	r3, [r4, #240]
  51 001a 13F0200F 		tst	r3, #32
  52 001e 06D0     		beq	.L3
  40:Ourtasks/ContactorUpdates.c **** 	{
  41:Ourtasks/ContactorUpdates.c **** 		pcf->outstat &= ~CNCTOUT05KA;	
  53              		.loc 1 41 0
  54 0020 23F02003 		bic	r3, r3, #32
  55 0024 C4F8F030 		str	r3, [r4, #240]
  42:Ourtasks/ContactorUpdates.c **** 		contactor_msg_ka(pcf);
  56              		.loc 1 42 0
  57 0028 2046     		mov	r0, r4
  58              	.LVL1:
  59 002a FFF7FEFF 		bl	contactor_msg_ka
  60              	.LVL2:
  61              	.L3:
  43:Ourtasks/ContactorUpdates.c **** 	}
  44:Ourtasks/ContactorUpdates.c **** 
  45:Ourtasks/ContactorUpdates.c **** 	/* Contactor #1 energization */
  46:Ourtasks/ContactorUpdates.c **** 	if ( ((pcf->outstat & (CNCTOUT00K1 | CNCTOUT06KAw)) ^ (pcf->outstat_prev & (CNCTOUT00K1 | CNCTOUT0
  62              		.loc 1 46 0
  63 002e D4F8F020 		ldr	r2, [r4, #240]
  64 0032 D4F8F430 		ldr	r3, [r4, #244]
  65 0036 82EA0301 		eor	r1, r2, r3
  66 003a 11F0410F 		tst	r1, #65
  67 003e 37D0     		beq	.L4
  47:Ourtasks/ContactorUpdates.c **** 	{ // Either/both energize or pwm coil requested
  48:Ourtasks/ContactorUpdates.c **** 		if ((pcf->outstat & CNCTOUT00K1) != 0)
ARM GAS  /tmp/ccUZsBcp.s 			page 3


  68              		.loc 1 48 0
  69 0040 12F0010F 		tst	r2, #1
  70 0044 20D0     		beq	.L5
  49:Ourtasks/ContactorUpdates.c **** 		{ // Here, contactor off-->on
  50:Ourtasks/ContactorUpdates.c **** 			if ((pcf->outstat & CNCTOUT06KAw) == 0)
  71              		.loc 1 50 0
  72 0046 12F0400F 		tst	r2, #64
  73 004a 09D1     		bne	.L6
  51:Ourtasks/ContactorUpdates.c **** 			{ // Contactor ON, PWM OFF
  52:Ourtasks/ContactorUpdates.c **** 				pcf->sConfigOCn.Pulse = (htim4.Init.Period+2); // Max+1 PWM period
  74              		.loc 1 52 0
  75 004c 424A     		ldr	r2, .L15
  76 004e D268     		ldr	r2, [r2, #12]
  77 0050 0232     		adds	r2, r2, #2
  78 0052 C4F82C22 		str	r2, [r4, #556]
  53:Ourtasks/ContactorUpdates.c **** 				pcf->outstat_prev |= CNCTOUT00K1;
  79              		.loc 1 53 0
  80 0056 43F00103 		orr	r3, r3, #1
  81 005a C4F8F430 		str	r3, [r4, #244]
  82 005e 07E0     		b	.L7
  83              	.L6:
  54:Ourtasks/ContactorUpdates.c **** 			}
  55:Ourtasks/ContactorUpdates.c **** 			else
  56:Ourtasks/ContactorUpdates.c **** 			{ // Contactor was on, switch to pwm
  57:Ourtasks/ContactorUpdates.c **** 				pcf->sConfigOCn.Pulse = pcf->ipwmpct1; // PWM period for #1
  84              		.loc 1 57 0
  85 0060 D4F82022 		ldr	r2, [r4, #544]
  86 0064 C4F82C22 		str	r2, [r4, #556]
  58:Ourtasks/ContactorUpdates.c **** 				pcf->outstat_prev |= CNCTOUT06KAw;
  87              		.loc 1 58 0
  88 0068 43F04003 		orr	r3, r3, #64
  89 006c C4F8F430 		str	r3, [r4, #244]
  90              	.L7:
  59:Ourtasks/ContactorUpdates.c **** 			}
  60:Ourtasks/ContactorUpdates.c **** 			HAL_TIM_PWM_ConfigChannel(&htim4, &pcf->sConfigOCn, TIM_CHANNEL_3);
  91              		.loc 1 60 0
  92 0070 394D     		ldr	r5, .L15
  93 0072 0822     		movs	r2, #8
  94 0074 04F50A71 		add	r1, r4, #552
  95 0078 2846     		mov	r0, r5
  96 007a FFF7FEFF 		bl	HAL_TIM_PWM_ConfigChannel
  97              	.LVL3:
  61:Ourtasks/ContactorUpdates.c **** 			HAL_TIM_PWM_Start(&htim4, TIM_CHANNEL_3);  
  98              		.loc 1 61 0
  99 007e 0821     		movs	r1, #8
 100 0080 2846     		mov	r0, r5
 101 0082 FFF7FEFF 		bl	HAL_TIM_PWM_Start
 102              	.LVL4:
 103 0086 13E0     		b	.L4
 104              	.L5:
  62:Ourtasks/ContactorUpdates.c **** 		}
  63:Ourtasks/ContactorUpdates.c **** 		else
  64:Ourtasks/ContactorUpdates.c **** 		{ // Contactor OFF; 
  65:Ourtasks/ContactorUpdates.c **** 			pcf->sConfigOCn.Pulse = 0; // Period = 0 is OFF
 105              		.loc 1 65 0
 106 0088 0023     		movs	r3, #0
 107 008a C4F82C32 		str	r3, [r4, #556]
ARM GAS  /tmp/ccUZsBcp.s 			page 4


  66:Ourtasks/ContactorUpdates.c **** 			HAL_TIM_PWM_ConfigChannel(&htim4, &pcf->sConfigOCn, TIM_CHANNEL_3);
 108              		.loc 1 66 0
 109 008e 324D     		ldr	r5, .L15
 110 0090 0822     		movs	r2, #8
 111 0092 04F50A71 		add	r1, r4, #552
 112 0096 2846     		mov	r0, r5
 113 0098 FFF7FEFF 		bl	HAL_TIM_PWM_ConfigChannel
 114              	.LVL5:
  67:Ourtasks/ContactorUpdates.c **** 			HAL_TIM_PWM_Start(&htim4, TIM_CHANNEL_3);  
 115              		.loc 1 67 0
 116 009c 0821     		movs	r1, #8
 117 009e 2846     		mov	r0, r5
 118 00a0 FFF7FEFF 		bl	HAL_TIM_PWM_Start
 119              	.LVL6:
  68:Ourtasks/ContactorUpdates.c **** 			pcf->outstat_prev &= ~(CNCTOUT00K1 | CNCTOUT06KAw); // Reset requests
 120              		.loc 1 68 0
 121 00a4 D4F8F430 		ldr	r3, [r4, #244]
 122 00a8 23F04103 		bic	r3, r3, #65
 123 00ac C4F8F430 		str	r3, [r4, #244]
 124              	.L4:
  69:Ourtasks/ContactorUpdates.c **** 		}
  70:Ourtasks/ContactorUpdates.c **** 	}
  71:Ourtasks/ContactorUpdates.c **** 
  72:Ourtasks/ContactorUpdates.c **** 	/* Contactor #2 energization */
  73:Ourtasks/ContactorUpdates.c **** 	if ( ((pcf->outstat & (CNCTOUT01K2 | CNCTOUT07KAw)) ^ (pcf->outstat_prev & (CNCTOUT01K2 | CNCTOUT0
 125              		.loc 1 73 0
 126 00b0 D4F8F020 		ldr	r2, [r4, #240]
 127 00b4 D4F8F430 		ldr	r3, [r4, #244]
 128 00b8 82EA0301 		eor	r1, r2, r3
 129 00bc 11F0820F 		tst	r1, #130
 130 00c0 37D0     		beq	.L8
  74:Ourtasks/ContactorUpdates.c **** 	{ // Either/both energize or pwm coil requested
  75:Ourtasks/ContactorUpdates.c **** 		if ((pcf->outstat & CNCTOUT01K2) != 0)
 131              		.loc 1 75 0
 132 00c2 12F0020F 		tst	r2, #2
 133 00c6 20D0     		beq	.L9
  76:Ourtasks/ContactorUpdates.c **** 		{  // Here, contactor off-->on
  77:Ourtasks/ContactorUpdates.c **** 			if ((pcf->outstat & CNCTOUT07KAw) == 0)
 134              		.loc 1 77 0
 135 00c8 12F0800F 		tst	r2, #128
 136 00cc 09D1     		bne	.L10
  78:Ourtasks/ContactorUpdates.c **** 			{ // Contactor ON, PWM OFF
  79:Ourtasks/ContactorUpdates.c **** 				pcf->sConfigOCn.Pulse = (htim3.Init.Period+2); // Max+1 PWM period
 137              		.loc 1 79 0
 138 00ce 234A     		ldr	r2, .L15+4
 139 00d0 D268     		ldr	r2, [r2, #12]
 140 00d2 0232     		adds	r2, r2, #2
 141 00d4 C4F82C22 		str	r2, [r4, #556]
  80:Ourtasks/ContactorUpdates.c **** 				pcf->outstat_prev |= CNCTOUT01K2;
 142              		.loc 1 80 0
 143 00d8 43F00203 		orr	r3, r3, #2
 144 00dc C4F8F430 		str	r3, [r4, #244]
 145 00e0 07E0     		b	.L11
 146              	.L10:
  81:Ourtasks/ContactorUpdates.c **** 			}
  82:Ourtasks/ContactorUpdates.c **** 			else
  83:Ourtasks/ContactorUpdates.c **** 			{ // Contactor was on, switch to pwm
ARM GAS  /tmp/ccUZsBcp.s 			page 5


  84:Ourtasks/ContactorUpdates.c **** 				pcf->sConfigOCn.Pulse = pcf->ipwmpct2; // PWM period for #2
 147              		.loc 1 84 0
 148 00e2 D4F82422 		ldr	r2, [r4, #548]
 149 00e6 C4F82C22 		str	r2, [r4, #556]
  85:Ourtasks/ContactorUpdates.c **** 				pcf->outstat_prev |= CNCTOUT07KAw;
 150              		.loc 1 85 0
 151 00ea 43F08003 		orr	r3, r3, #128
 152 00ee C4F8F430 		str	r3, [r4, #244]
 153              	.L11:
  86:Ourtasks/ContactorUpdates.c **** 			}
  87:Ourtasks/ContactorUpdates.c **** 			HAL_TIM_PWM_ConfigChannel(&htim3, &pcf->sConfigOCn, TIM_CHANNEL_2);
 154              		.loc 1 87 0
 155 00f2 1A4D     		ldr	r5, .L15+4
 156 00f4 0422     		movs	r2, #4
 157 00f6 04F50A71 		add	r1, r4, #552
 158 00fa 2846     		mov	r0, r5
 159 00fc FFF7FEFF 		bl	HAL_TIM_PWM_ConfigChannel
 160              	.LVL7:
  88:Ourtasks/ContactorUpdates.c **** 			HAL_TIM_PWM_Start(&htim3, TIM_CHANNEL_2);  
 161              		.loc 1 88 0
 162 0100 0421     		movs	r1, #4
 163 0102 2846     		mov	r0, r5
 164 0104 FFF7FEFF 		bl	HAL_TIM_PWM_Start
 165              	.LVL8:
 166 0108 13E0     		b	.L8
 167              	.L9:
  89:Ourtasks/ContactorUpdates.c **** 		}
  90:Ourtasks/ContactorUpdates.c **** 		else
  91:Ourtasks/ContactorUpdates.c **** 		{ // Contactor OFF; 
  92:Ourtasks/ContactorUpdates.c **** 			pcf->sConfigOCn.Pulse = 0; // Period = 0
 168              		.loc 1 92 0
 169 010a 0023     		movs	r3, #0
 170 010c C4F82C32 		str	r3, [r4, #556]
  93:Ourtasks/ContactorUpdates.c **** 			HAL_TIM_PWM_ConfigChannel(&htim3, &pcf->sConfigOCn, TIM_CHANNEL_2);
 171              		.loc 1 93 0
 172 0110 124D     		ldr	r5, .L15+4
 173 0112 0422     		movs	r2, #4
 174 0114 04F50A71 		add	r1, r4, #552
 175 0118 2846     		mov	r0, r5
 176 011a FFF7FEFF 		bl	HAL_TIM_PWM_ConfigChannel
 177              	.LVL9:
  94:Ourtasks/ContactorUpdates.c **** 			HAL_TIM_PWM_Start(&htim3, TIM_CHANNEL_2);  
 178              		.loc 1 94 0
 179 011e 0421     		movs	r1, #4
 180 0120 2846     		mov	r0, r5
 181 0122 FFF7FEFF 		bl	HAL_TIM_PWM_Start
 182              	.LVL10:
  95:Ourtasks/ContactorUpdates.c **** 			pcf->outstat_prev &= ~(CNCTOUT01K2 | CNCTOUT07KAw);
 183              		.loc 1 95 0
 184 0126 D4F8F430 		ldr	r3, [r4, #244]
 185 012a 23F08203 		bic	r3, r3, #130
 186 012e C4F8F430 		str	r3, [r4, #244]
 187              	.L8:
  96:Ourtasks/ContactorUpdates.c **** 		}
  97:Ourtasks/ContactorUpdates.c **** 	}
  98:Ourtasks/ContactorUpdates.c **** 
  99:Ourtasks/ContactorUpdates.c **** 	/* DMOC FET enabling. */
ARM GAS  /tmp/ccUZsBcp.s 			page 6


 100:Ourtasks/ContactorUpdates.c **** 	if ((pcf->outstat & CNCTOUT04EN) != 0)
 188              		.loc 1 100 0
 189 0132 D4F8F030 		ldr	r3, [r4, #240]
 190 0136 13F0100F 		tst	r3, #16
 191 013a 06D0     		beq	.L12
 101:Ourtasks/ContactorUpdates.c **** 	{ // Turn on FET for DMOC hardware enable
 102:Ourtasks/ContactorUpdates.c **** 		HAL_GPIO_WritePin(GPIOC, GPIO_PIN_14, GPIO_PIN_SET);
 192              		.loc 1 102 0
 193 013c 0122     		movs	r2, #1
 194 013e 4FF48041 		mov	r1, #16384
 195 0142 0748     		ldr	r0, .L15+8
 196 0144 FFF7FEFF 		bl	HAL_GPIO_WritePin
 197              	.LVL11:
 198 0148 38BD     		pop	{r3, r4, r5, pc}
 199              	.LVL12:
 200              	.L12:
 103:Ourtasks/ContactorUpdates.c **** 	}
 104:Ourtasks/ContactorUpdates.c **** 	else
 105:Ourtasks/ContactorUpdates.c **** 	{ // Turn FET off.
 106:Ourtasks/ContactorUpdates.c **** 		HAL_GPIO_WritePin(GPIOC, GPIO_PIN_14, GPIO_PIN_RESET);
 201              		.loc 1 106 0
 202 014a 0022     		movs	r2, #0
 203 014c 4FF48041 		mov	r1, #16384
 204 0150 0348     		ldr	r0, .L15+8
 205 0152 FFF7FEFF 		bl	HAL_GPIO_WritePin
 206              	.LVL13:
 207 0156 38BD     		pop	{r3, r4, r5, pc}
 208              	.LVL14:
 209              	.L16:
 210              		.align	2
 211              	.L15:
 212 0158 00000000 		.word	htim4
 213 015c 00000000 		.word	htim3
 214 0160 00100140 		.word	1073811456
 215              		.cfi_endproc
 216              	.LFE69:
 218              		.text
 219              	.Letext0:
 220              		.file 2 "/home/deh/launchpad/gcc-arm-none-eabi-5_4-2016q3/arm-none-eabi/include/machine/_default_t
 221              		.file 3 "/home/deh/launchpad/gcc-arm-none-eabi-5_4-2016q3/arm-none-eabi/include/sys/_stdint.h"
 222              		.file 4 "Middlewares/Third_Party/FreeRTOS/Source/include/timers.h"
 223              		.file 5 "Drivers/CMSIS/Device/ST/STM32F1xx/Include/stm32f103xb.h"
 224              		.file 6 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_def.h"
 225              		.file 7 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_gpio.h"
 226              		.file 8 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_dma.h"
 227              		.file 9 "Drivers/STM32F1xx_HAL_Driver/Inc/stm32f1xx_hal_tim.h"
 228              		.file 10 "Ourwares/common_misc.h"
 229              		.file 11 "Ourwares/common_can.h"
 230              		.file 12 "Ourtasks/iir_filter_lx.h"
 231              		.file 13 "Ourtasks/contactor_idx_v_struct.h"
 232              		.file 14 "Ourtasks/adc_idx_v_struct.h"
 233              		.file 15 "Ourwares/CanTask.h"
 234              		.file 16 "Ourtasks/ContactorTask.h"
 235              		.file 17 "Ourtasks/adcparams.h"
 236              		.file 18 "Ourtasks/cic_filter_l_N2_M3.h"
 237              		.file 19 "Drivers/CMSIS/Include/core_cm3.h"
 238              		.file 20 "Ourtasks/contactor_msgs.h"
ARM GAS  /tmp/ccUZsBcp.s 			page 7


ARM GAS  /tmp/ccUZsBcp.s 			page 8


DEFINED SYMBOLS
                            *ABS*:00000000 ContactorUpdates.c
     /tmp/ccUZsBcp.s:20     .text.ContactorUpdates:00000000 $t
     /tmp/ccUZsBcp.s:25     .text.ContactorUpdates:00000000 ContactorUpdates
     /tmp/ccUZsBcp.s:212    .text.ContactorUpdates:00000158 $d
                     .debug_frame:00000010 $d

UNDEFINED SYMBOLS
contactor_msg_ka
HAL_TIM_PWM_ConfigChannel
HAL_TIM_PWM_Start
HAL_GPIO_WritePin
htim4
htim3
